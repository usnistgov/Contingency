stages:
  - pages

variables:
  UV_VERSION: "0.9.28"
  PYTHON_VERSION: "3.12"
  BASE_LAYER: alpine
  # GitLab CI creates a separate mountpoint for the build directory,
  # so we need to copy instead of using hard links.
  UV_LINK_MODE: copy

zensical:
  image: ghcr.io/astral-sh/uv:$UV_VERSION-python$PYTHON_VERSION-$BASE_LAYER
  stage: pages
  before_script:
    - apk add g++ build-base linux-headers
  script:
    - uv sync
    - uv run zensical build
    - mv site public
  artifacts:
    paths:
      - public
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
